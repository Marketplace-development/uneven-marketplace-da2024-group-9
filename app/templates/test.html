@app.route('/chats')
def chats_page():
    if 'username' not in session:
        flash('You must log in to view chats.', 'error')
        return redirect('/login')

    username = session['username']
    user_chats = {}

    # Filter berichten op basis van de huidige gebruiker
    for chat_key, messages in chats.items():
        partner = next((msg['sender'] for msg in messages if msg['sender'] != username), "Unknown")
        user_chats[chat_key] = {
            'partner': partner,
            'messages': messages,
            'task_id': chat_key
        }

    # Voeg calculate_average_rating toe aan de template context
    return render_template('chats.html', chats=user_chats, username=username, calculate_average_rating=calculate_average_rating)

